// 1. Cosine distance function
// Computes cosine distance between two vectors a and b.
// Cosine distance = 1 - cosine similarity. Used to measure the angular difference between two vectors.
const cosineDistance = (a, b) => 1 - math.dot(a, b) / (math.norm(a) * math.norm(b));

// 2. Calculate distance matrix
// Computes the pairwise cosine distance between every pair of vectors in x_seq and y_seq.
// Returns a 2D matrix where element (i, j) contains the cosine distance between x_seq[i] and y_seq[j].
const computeDistanceMatrix = (xSeq, ySeq) =>
  xSeq.map(x => ySeq.map(y => cosineDistance(x, y)));

// 3. Dynamic programming alignment path
// Computes the optimal alignment path between x_seq and y_seq using dynamic programming.
// Cost matrix is filled using a recurrence relation where each cell contains the minimum cost
// to reach that point from the start, accounting for the distances between corresponding points in the sequences.
const dp = (distMat) => {
    const [rows, cols] = [distMat.length, distMat[0].length];
    
    // Initialize the cost matrix with "Infinity" to represent uncomputed values.
    const costMat = Array.from({ length: rows }, () => Array(cols).fill(Infinity));
    
    // Base case: the cost to reach the first point (0,0) is simply the distance at that point.
    costMat[0][0] = distMat[0][0];

    // Fill in the first row and first column, which can only be reached by moving right or down.
    for (let i = 1; i < rows; i++) costMat[i][0] = costMat[i - 1][0] + distMat[i][0];
    for (let j = 1; j < cols; j++) costMat[0][j] = costMat[0][j - 1] + distMat[0][j];

    // Fill the rest of the cost matrix. Each cell depends on the minimum cost of the three neighboring cells.
    for (let i = 1; i < rows; i++) {
        for (let j = 1; j < cols; j++) {
            // Recurrence relation to compute the cost for reaching (i, j).
            costMat[i][j] = distMat[i][j] + Math.min(costMat[i - 1][j], costMat[i][j - 1], costMat[i - 1][j - 1]);
        }
    }

    // Backtrack to find the optimal path by moving through the matrix from the bottom-right to top-left.
    let [i, j] = [rows - 1, cols - 1], path = [[i, j]];  // Start at the bottom-right corner
    while (i > 0 || j > 0) {
        if (i === 0) j--;  // If at the top row, move left
        else if (j === 0) i--;  // If at the leftmost column, move up
        else {
            // Choose the direction that offers the lowest cost.
            const minCost = Math.min(costMat[i - 1][j], costMat[i][j - 1], costMat[i - 1][j - 1]);
            minCost === costMat[i - 1][j - 1] ? (i--, j--) : minCost === costMat[i - 1][j] ? i-- : j--;
        }
        path.push([i, j]);  // Add the step to the path
    }

    // Calculate the sequence lengths
    const M = distMat.length;
    const N = distMat[0].length;

    // The total cost of alignment is normalized by the length of both sequences.
    const normalizedCost = costMat[rows - 1][cols - 1] / (M + N);
    
    // Return the path, cost matrix, and normalized cost for further use.
    return { path: path.reverse(), costMat, normalizedCost };
};

//4. Function to create heatmap with alignment path as lines
// The heatmap shows the pairwise cosine distances between elements of x_seq and y_seq.
// The optimal alignment path, computed using dynamic programming, is drawn on top as black lines.

function createHeatmapWithLines(distMat, path) {
    const data = [{
        z: distMat,  // The heatmap data corresponds to the distance matrix.
        type: 'heatmap',
        colorscale: 'Viridis'  // Color scale for the heatmap
    }];

    // Create lines connecting consecutive points in the alignment path.
    const shapes = path.map((p, i) => {
        if (i === path.length - 1) return null;  // Skip the last point as it has no next point to connect to
        const [x0, y0] = path[i];
        const [x1, y1] = path[i + 1];
        return {
            type: 'line',
            xref: 'x',  // Refer to the x-axis for horizontal positioning
            yref: 'y',  // Refer to the y-axis for vertical positioning
            x0: y0,
            y0: x0,
            x1: y1,
            y1: x1,
            line: {
                color: 'black',  // Line color to show the alignment path
                width: 2  // Line thickness
            }
        };
    }).filter(Boolean);  // Remove null values

    // Layout for the plot, including axis titles and the alignment path lines.
    const layout = {
        title: 'Cosine Distance Matrix and Alignment Path',
        xaxis: { title: 'Y Sequence', titlefont: {size: 14} },
        yaxis: { title: 'X Sequence', titlefont: {size: 14} },
        shapes: shapes  // Add the path lines to the plot
    };

    // Render the heatmap and the alignment path using Plotly
    Plotly.newPlot('plot1', data, layout);
}

// 5. Process stretch data after the detection is complete
function processStretchData(stretchDataTimeSeries) {
    // Here, you can perform any preprocessing if needed
    // For now, we directly call compareStretchData with the collected data
    compareStretchData(stretchDataTimeSeries);
}

// 6. Compare the collected stretch data with a reference sequence
function compareStretchData(stretchDataTimeSeries) {
    const referenceSeq =  [
        [
          -30.57098388671875,
          -94.67103481292725,
          3.7160491943359375,
          1.789083480834961,
          -128.10256958007812,
          -0.32867431640625,
          -54.82006072998047,
          -0.16931533813476562,
          70.37530899047852,
          -19.795875549316406
        ],
        [
          -3.7480640411376953,
          -120.83486080169678,
          15.755462646484375,
          39.84272003173828,
          -104.67399597167969,
          -45.92714309692383,
          -72.83149719238281,
          -2.2249317169189453,
          157.97239303588867,
          -10.320625305175781
        ],
        [
          35.393501764364544,
          -141.54981094437932,
          23.8480964855886,
          50.95747012945611,
          -54.6848624033139,
          -53.47614471400459,
          -70.81796136302927,
          16.486491260589105,
          114.29240494494587,
          -22.07744784528785
        ],
        [
          11.646399331746522,
          -150.67211784074794,
          26.545192517321993,
          48.66326686329711,
          -96.86695040136306,
          -89.70759092804445,
          -79.07231818076238,
          32.97660320751879,
          97.51602740245005,
          -52.46950846159211
        ],
        [
          30.94459191961414,
          -127.37632747204367,
          43.99103200023637,
          49.18029958269801,
          -71.08393462616039,
          -30.67264530170729,
          -52.355732527693874,
          9.28532495535859,
          177.3346985308429,
          -13.730991551176032
        ],
        [
          17.55148905701617,
          -123.10042737170278,
          27.78724185259682,
          38.27619905133457,
          -63.92507034352775,
          -14.556047662739104,
          -63.899785583568274,
          11.243167433851397,
          156.3530318431187,
          -16.944165146144883
        ],
        [
          27.269932502898087,
          -118.38508278712584,
          27.53579770211786,
          33.12313515310973,
          -59.247487230565184,
          -18.78191659288541,
          -57.263370595787876,
          3.0850606854021976,
          200.5805767880277,
          -17.543619719822686
        ],
        [
          27.21573668768673,
          -124.92148945806508,
          29.14884481362833,
          49.639698927156246,
          -69.84373736113082,
          -34.693690565929955,
          -75.97350779405377,
          13.612942681721222,
          187.6587971525521,
          -6.843835234539256
        ],
        [
          0.6993913429479903,
          -125.86832736631999,
          6.8082424230449305,
          30.34613407514985,
          -103.22603856399701,
          -47.3900079351331,
          -46.221700845234665,
          -3.761043693667091,
          86.97934458539436,
          -23.496321592180664
        ],
        [
          -7.7790333473247415,
          -103.66481868862837,
          10.978898142464232,
          59.3602506421941,
          -61.88578560048097,
          -43.87272493488183,
          -44.50317844579732,
          17.07515582769514,
          126.96103001511679,
          -16.442668622460417
        ],
        [
          2.4064414037969755,
          -118.89749343580218,
          22.318098778449553,
          51.28406740858435,
          -135.6369184390158,
          -36.00089204857278,
          -33.79289484742122,
          6.976447200767211,
          98.12755276097107,
          -11.059153001115476
        ],
        [
          12.25347726199368,
          -121.75806587611197,
          -1.8090141610300634,
          24.86771592608204,
          -97.02357619501288,
          -18.851950172066438,
          -31.95676834353634,
          10.372427504300617,
          69.94098729777633,
          -20.27858997810432
        ],
        [
          0.032024383544921875,
          -107.73221969604492,
          13.669013977050781,
          37.55327224731445,
          -106.1385726928711,
          -26.762351989746094,
          -32.06758499145508,
          19.579553604125977,
          78.13739776611328,
          -15.024290084838867
        ],
        [
          -31.798855982712553,
          -100.3068649059004,
          6.478075370126476,
          -2.9180651095367125,
          -119.38127330031921,
          -5.741439013658237,
          -66.42570222043821,
          9.136497598762503,
          65.60025276988404,
          -20.668180825812613
        ],
        [
          0.7958887617647861,
          -116.89950044817277,
          5.302292128413683,
          -6.000207788098351,
          -75.85107398750483,
          -50.5533278378544,
          -45.60644361601342,
          1.790091575762574,
          82.24848996572925,
          -26.914351409963842
        ],
        [
          -58.05199928022901,
          -73.58398394177726,
          45.0576886364301,
          121.43010705180382,
          -155.39125562873016,
          -15.860617641584838,
          -45.13206954248294,
          83.31004424216042,
          28.57746665966667,
          -22.6879891055396
        ],
        [
          -46.77752326763127,
          -78.22112469098101,
          -4.820405765569149,
          64.28585089721474,
          -97.67801603068995,
          5.523951923044365,
          -66.7727089848508,
          64.21690592281374,
          100.24678814510577,
          -8.701998637712677
        ],
        [
          -16.360481191928613,
          -117.80023836898596,
          68.26512172674506,
          144.9041483001874,
          -124.97924638720968,
          -35.70084392702387,
          -86.16821667860063,
          158.96312905745197,
          64.26749663776346,
          0.035020550639728754
        ],
        [
          -15.72944000544095,
          -120.49592886104472,
          22.236926130946813,
          111.92976007270232,
          -84.16833411833278,
          -23.9681619853273,
          -108.4589117761769,
          150.02372285922604,
          30.235660652337515,
          0.4937074170223923
        ],
        [
          11.029260029233967,
          -177.5770853288423,
          25.65591919321787,
          96.41955448612794,
          -116.75414912430693,
          -84.02738639729449,
          -65.2024102759257,
          80.50713176426717,
          103.98401620085866,
          -18.4639870108187
        ],
        [
          10.232398004271886,
          -202.99008719910714,
          12.550343961652743,
          81.1189833110991,
          -82.54552180824203,
          -73.00201314856031,
          -78.50003448827766,
          42.44209339001395,
          128.74647908469422,
          -14.519832869538277
        ],
        [
          28.188547609605962,
          -192.86566442281205,
          18.586915336417974,
          74.7786520069294,
          -81.17691590673292,
          -51.607958544236055,
          -114.04208724146858,
          104.5646847156118,
          75.33052449874177,
          -3.1786352682660777
        ],
        [
          -0.43091356853113894,
          -169.56582360330748,
          60.85065689508076,
          110.25446107313167,
          -85.6808206683254,
          -36.0743211685417,
          -91.48650045301179,
          104.57867120596399,
          90.37929415911378,
          -18.682083189191815
        ],
        [
          34.18052679494548,
          -145.93990588823468,
          39.71081459869765,
          96.24417092640687,
          -52.59529544471036,
          -28.65121459700879,
          -127.22877976861331,
          96.18336704334155,
          109.46053228607467,
          -5.03352694735986
        ],
        [
          23.636891260547714,
          -146.52678368860725,
          25.39708030548917,
          87.24316270199841,
          -65.16360374582757,
          -59.10103337686684,
          -119.65225622228802,
          93.69444344896044,
          104.10238984160348,
          -11.109645142664078
        ],
        [
          2.9013576930178715,
          -162.24744655153893,
          76.2600668221487,
          84.27546784074735,
          -109.50244772073717,
          -37.63113744168146,
          -109.78312448374098,
          84.00950412911158,
          86.84544379793098,
          -6.135245743238158
        ],
        [
          -5.290988451115481,
          -175.67280217111644,
          94.52210062844392,
          80.72438071359414,
          -92.38284230114357,
          -13.366863078504593,
          -88.92262267743314,
          67.61704347085589,
          108.89224798372476,
          -5.239976122479504
        ],
        [
          -2.9442513006238755,
          -161.67686593745512,
          43.50732289340044,
          74.92747863746717,
          -73.17823099957155,
          -16.51621117632766,
          -80.39777697881331,
          79.23246079420545,
          86.38156318285851,
          -6.503457512402747
        ],
        [
          -17.531296744247243,
          -189.4870914582986,
          61.50838241632948,
          62.9133754956743,
          -120.9295613306162,
          -36.38285911487037,
          -76.21702469688606,
          74.41081718882629,
          99.19287320043725,
          -22.331905165552143
        ],
        [
          -12.907636697354121,
          -168.7652681557101,
          52.95651871978305,
          130.76016703894766,
          -107.81360457308892,
          -80.27567816486379,
          -91.25654515411748,
          144.29920728022722,
          101.11547841115424,
          -17.226536593049957
        ],
        [
          -19.7496442627139,
          -164.068702875749,
          72.242958681863,
          130.99986681130713,
          -73.74850467839224,
          -21.425923899202303,
          -73.47997185384591,
          107.11161247858331,
          78.99263196945185,
          -4.240814414827128
        ],
        [
          -15.299297606548748,
          -202.43097823379247,
          41.70326407827963,
          111.89761181017457,
          -112.21642663612818,
          -59.95415631153202,
          -86.03982408543655,
          111.54424953768091,
          115.21396228910635,
          -8.596377228514598
        ],
        [
          -8.105083568782504,
          -165.2886757821891,
          70.01540015782496,
          120.84225029038242,
          -105.00503957772094,
          -36.1745963798154,
          -87.72045904896589,
          94.22088874509888,
          67.09274745960252,
          -6.70431569299916
        ],
        [
          -9.07442004661499,
          -165.29968235989392,
          55.92476920240779,
          102.38640987825858,
          -102.88697511211706,
          -42.351521812530336,
          -89.60868445330101,
          75.75355997441534,
          102.5862138120697,
          -3.5560703226158807
        ],
        [
          -8.361713358976658,
          -126.63803375794663,
          58.522280400125055,
          95.48258824142857,
          -133.47448746255515,
          -27.439409997168298,
          -137.4915435421713,
          98.07362023831553,
          32.726522833497825,
          -18.28361437075182
        ],
        [
          -14.002346670846464,
          -132.15872305368754,
          54.51276171542497,
          60.06427270332546,
          -133.95812934293133,
          -139.91221117566738,
          -155.74519005635312,
          29.513297088335264,
          165.39703463771934,
          -233.62157437838772
        ],
        [
          -9.604270069694337,
          -117.01784697699287,
          76.68099905326847,
          33.540495965575644,
          -95.50125907546806,
          -208.8294298421479,
          -122.83262295206282,
          1.5060753099541557,
          157.1777315438589,
          -174.7667346462018
        ],
        [
          7.7255765734108195,
          -112.61350614318263,
          85.73966926568005,
          18.4175645116174,
          -19.415229580321352,
          -166.05748555332957,
          -146.16514455236918,
          48.99768264710809,
          177.68864627812107,
          -198.95130988658795
        ],
        [
          -6.214839744964422,
          -104.74094331194402,
          78.02741639392252,
          17.82208051144704,
          -45.526130896558016,
          -140.36012443126714,
          -132.32767386584388,
          38.2044600770912,
          169.34298737140867,
          -191.4498659531771
        ],
        [
          -5.235822726093716,
          -99.38102008860551,
          76.90107382362851,
          38.570829615902596,
          -47.34970056538941,
          -133.3559020623943,
          -131.07832187940852,
          37.472924429602415,
          164.0976864482634,
          -170.3548493990976
        ],
        [
          -3.6032300879436434,
          -95.60581000941806,
          74.09060823601499,
          54.01955335016453,
          -73.84593146460054,
          -138.80625476393266,
          -102.1413753807216,
          33.5999173097041,
          160.3440260180803,
          -165.44251115828018
        ],
        [
          -8.232219161294267,
          -115.7946978100756,
          65.02133411938962,
          64.33511633415907,
          -127.88446839847626,
          -47.08509921052507,
          -168.53335233016273,
          57.88536913919535,
          133.21530681620217,
          -150.49628877300836
        ],
        [
          -9.44162812717957,
          -127.50381124488848,
          52.96658707948097,
          69.09519847788329,
          -109.74381148216975,
          -29.101141301826942,
          -116.4016319717276,
          56.978745275501296,
          122.5766999691325,
          5.540258164962665
        ],
        [
          -8.4037456168071,
          -130.33091691268203,
          51.60177909212109,
          67.48236762344214,
          -105.58596432363731,
          -25.613436445003288,
          -111.62268166444696,
          56.90490782580406,
          101.3046773631649,
          -2.1561992132312753
        ],
        [
          -2.5884620420969213,
          -133.98256120948002,
          57.833542381057896,
          62.5034606287399,
          -114.82996600984734,
          -54.66864549764466,
          -149.74122149780072,
          63.478444336357654,
          43.06149683632758,
          -23.376483948092755
        ],
        [
          -8.20055784387307,
          -133.6334984684354,
          50.09584974976235,
          67.2993838895166,
          -61.627294202986604,
          -9.772207315347202,
          -17.62837129113774,
          97.4692213272146,
          54.63649203012352,
          -13.870441163993462
        ],
        [
          -6.10957285205086,
          -124.58688759610135,
          28.481909672350866,
          7.01872370321297,
          -110.78753767646594,
          -121.48469048998558,
          -118.75236139047871,
          -106.33369423504433,
          34.780432592199475,
          -137.3784084910571
        ],
        [
          -5.048339808607182,
          -130.61308643548446,
          15.50982531391719,
          87.71250025463644,
          -26.65999273236389,
          -126.62471454520323,
          -4.738019537656896,
          62.15458329907182,
          59.77904059419444,
          -89.06711314026978
        ],
        [
          -9.974591631958504,
          -125.99421937589887,
          9.959541818080652,
          88.08985586730722,
          -15.49578986552649,
          -161.38069897346293,
          -16.723571742282843,
          75.40277628192285,
          65.66239108059534,
          -110.84726713031142
        ],
        [
          -8.05992669879413,
          -118.67790284216215,
          17.429794141987713,
          -4.306127177033602,
          -54.309013716614174,
          -133.03457925800728,
          -40.41158732965309,
          -54.00309218586182,
          48.31866134389989,
          -121.2907832010238
        ],
        [
          -20.22877126986168,
          -99.24808378759104,
          35.95335042702823,
          82.70700639653694,
          -125.68549453443939,
          -136.94612949999856,
          -114.46814627355934,
          -50.04350133092157,
          -8.036648476371312,
          -117.0871680855575
        ],
        [
          -18.61158291899835,
          -114.31824227172405,
          19.20636658897149,
          56.84940925894392,
          -119.3666775903481,
          -168.96796269094858,
          -153.96616524250442,
          -18.686495785497527,
          7.73381043535943,
          -119.74130284467063
        ],
        [
          -26.760530903897234,
          -125.98755785355502,
          53.27833227584381,
          79.69189430484215,
          -73.92208315884898,
          -31.955701899584483,
          -9.7693295987508,
          62.029408872527256,
          69.87538062858533,
          -12.76680690234457
        ],
        [
          -12.274342763612367,
          -123.45060899004034,
          10.23741087549115,
          12.690647132556421,
          -100.57125644487144,
          -126.36964864568847,
          -121.4547753462958,
          -45.70950138616371,
          -11.541231370739482,
          -118.08015311919752
        ],
        [
          -12.317328266068785,
          -118.19536723549794,
          37.977768029944855,
          66.85570332711188,
          -131.42869353144,
          -173.98440289470597,
          -118.10838221140918,
          -69.07668172157179,
          -7.450655256561532,
          -131.19758755794587
        ],
        [
          -9.139377162849144,
          -120.6236150752679,
          20.84871595848722,
          32.00416904957524,
          -95.25117610859309,
          -141.269522338142,
          -105.95216310363043,
          -84.65642838679264,
          16.186868973818093,
          -108.66521933747424
        ],
        [
          -12.726319021136248,
          -117.41616571076457,
          44.034513359860625,
          21.052871644641982,
          -124.91883936759706,
          -140.10188069318326,
          -108.78334785050694,
          -95.59650022411824,
          44.51475705579335,
          -104.10850776546437
        ],
        [
          -15.26422739032148,
          -128.0929302306032,
          25.301573819104988,
          0.63295486217595,
          -56.107901225540786,
          -182.1708844812184,
          -113.96206204851296,
          -112.05323505849327,
          66.81892699092151,
          -130.59107922320632
        ],
        [
          -17.58535559036426,
          -118.65557297574546,
          24.65568363944442,
          13.133568964913195,
          -101.09083091994353,
          -129.52674808423666,
          -118.63170495150635,
          -44.636723009367984,
          73.16133720050351,
          -172.16292892281663
        ],
        [
          -3.097790641917868,
          -124.85929754444714,
          31.61093410783417,
          19.37759853303089,
          -113.47695352267215,
          -126.9412337435158,
          -114.94167383846718,
          -75.78688861194013,
          41.16189498464567,
          -128.2873296206723
        ],
        [
          0.5189905874561873,
          -128.24630631803456,
          38.73361245765068,
          62.4579433280872,
          -128.70082598476796,
          -176.697851483185,
          -117.94671292183341,
          -53.70082475538317,
          9.971792969809172,
          -121.5850466304399
        ],
        [
          -3.0343850287594023,
          -130.49188829114854,
          -0.34350002787346057,
          22.22564307404076,
          -90.65377848711915,
          -142.37320825264476,
          -117.16135539912304,
          -46.31103952578985,
          -15.359005479992703,
          -115.68595859897673
        ],
        [
          -3.5106140727228876,
          -134.25097165034805,
          8.02939612412797,
          -3.322807837028506,
          -90.17006337114111,
          -129.08638158814813,
          -114.36028293574509,
          -68.79751151234007,
          -14.503651746225444,
          -116.46580970282832
        ],
        [
          -8.686101030972225,
          -126.42211600445671,
          17.077247153553003,
          32.42288470661373,
          -101.40292631674112,
          -132.82400407419277,
          -128.0228164966353,
          -80.34415684576265,
          13.101570731780384,
          -112.2842006237031
        ],
        [
          -8.86840475680691,
          -125.7053615284886,
          23.59924758729619,
          10.173135008410156,
          -97.4165878305053,
          -130.5030605061442,
          -127.31270432770654,
          -74.75046636447036,
          75.96431241718582,
          -122.83343215966553
        ],
        [
          -13.242066177567438,
          -127.69234863285826,
          28.610282998827756,
          1.9807580132809903,
          -29.188759997754346,
          -170.7630810037033,
          -124.87935904963655,
          -70.97105892710232,
          96.39998882932846,
          -138.6963501441882
        ],
        [
          -19.961651175763336,
          -136.38429962619128,
          63.511289183361555,
          -32.0395900735096,
          -68.315673477431,
          -205.05411408935754,
          -128.32825365228138,
          -66.05631536439944,
          123.68409416330036,
          -144.67303182142564
        ],
        [
          -29.462703729152793,
          -124.16577987250716,
          65.75866278401327,
          -52.838752789669684,
          -115.0916413497697,
          -167.96760738307225,
          -136.325349721936,
          -35.405977309701825,
          152.00563418392977,
          -135.2222452393368
        ],
        [
          -30.566068481504544,
          -122.64301326853024,
          50.614225958593806,
          -12.044455968039529,
          -114.48571650825761,
          -201.25637553558258,
          -138.1673390417681,
          -17.221960459406432,
          170.30066347854873,
          -134.62540778642636
        ],
        [
          -20.458362742909515,
          -137.48155281354886,
          36.25886394043289,
          79.46938136640318,
          -64.96945603520146,
          -128.70653586697927,
          -134.05316323202644,
          -29.479288331348585,
          122.26167964580358,
          -147.22583883812874
        ],
        [
          -11.759266946018442,
          -129.91508144400717,
          46.02837901299836,
          74.82421341996337,
          -90.3225684929148,
          -106.82991211724061,
          -118.20681178380951,
          -30.904105968585213,
          52.31063183400741,
          -134.36911119112307
        ],
        [
          -22.62046132995198,
          -139.35576617681733,
          49.589701368092506,
          106.43781213694456,
          -73.66086247338205,
          -24.01732768346119,
          -20.498852409037738,
          76.23591413679429,
          48.24558451746822,
          -13.88842901858851
        ],
        [
          -15.960571180710815,
          -137.38901785999337,
          59.68125109417997,
          107.61976010864913,
          -90.3759151668529,
          -27.754265326659663,
          -21.81985387076506,
          72.73305127414875,
          50.71246602022404,
          -13.229195787501624
        ],
        [
          -0.6764917431135586,
          -133.6376913868342,
          23.89738405798016,
          21.446009552829764,
          -112.14883833227248,
          -147.6067611080844,
          -135.3032245158559,
          -61.69967768863461,
          15.544743512174023,
          -126.01565809366792
        ],
        [
          -10.737550688234421,
          -119.98915545282952,
          41.46908719514977,
          56.826161571317584,
          -78.69387972646757,
          -101.91251600808351,
          -100.40339339505911,
          -62.60304917012883,
          15.21367396729434,
          -90.54429422902425
        ],
        [
          -15.719556287918692,
          -129.50182954018624,
          4.811777079217563,
          9.957301559691246,
          -99.06608802172332,
          -153.85758078949056,
          -114.72021844717096,
          -73.22524335951448,
          75.41950135689407,
          -143.1563906640743
        ],
        [
          -13.437540767258156,
          -131.87304885635552,
          45.43669541983763,
          -69.80766313024122,
          -56.3793795785499,
          -166.4181204931284,
          -121.55081836885356,
          -80.21617625661139,
          91.54982456675933,
          -144.94161466291763
        ],
        [
          -16.61174189240353,
          -122.90243403424327,
          53.071246720701765,
          -9.131800796220375,
          -87.1076825004211,
          -217.26086868672286,
          -116.01381143814291,
          -52.721394534099545,
          125.45560028660961,
          -170.35715557102822
        ],
        [
          -12.038546912147126,
          -131.71425733830807,
          51.224690424507685,
          8.389170290194272,
          -68.73443130265025,
          -218.07926920106652,
          -118.76447244517182,
          -42.414206919332116,
          172.81300701372737,
          -232.357565206451
        ],
        [
          -7.774915617452336,
          -134.7868002192955,
          79.099911055559,
          87.04019438710168,
          -80.26882803507726,
          -61.86560049843223,
          -157.8712389801674,
          62.74418868008422,
          29.75904230085675,
          -102.90412291926401
        ],
        [
          -6.16567855560163,
          -134.01597961514315,
          85.15567328047769,
          83.42188175073397,
          -109.95111309252025,
          -16.30423172790256,
          -84.81382717465937,
          89.2416675953537,
          90.58489564995386,
          -9.49491548345327
        ]
      ]
      
    // Compute distance matrix between the stretch data and reference sequence
    const distMat = computeDistanceMatrix(stretchDataTimeSeries, referenceSeq);

    // Call dp() to get the optimal alignment path and normalized cost
    const { path, costMat, normalizedCost } = dp(distMat);

    // Print the normalized cost for evaluation
    console.log("Normalized Cost:", normalizedCost);
    console.log("Distance Matrix:", distMat);
    console.log("Alignment Path:", path);

    // Visualize the result with a heatmap and path
    createHeatmapWithLines(distMat, path);

    // Transition to the next UI panel after detection ends
    showNextPanel();
}

